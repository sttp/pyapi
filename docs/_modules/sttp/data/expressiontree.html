<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sttp.data.expressiontree &mdash; sttp/pyapi 0.6.0 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="shortcut icon" href="https://raw.githubusercontent.com/sttp/pyapi/main/docs/img/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> sttp/pyapi
            <img src="https://raw.githubusercontent.com/sttp/pyapi/main/docs/img/sttp.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">sttp/pyapi</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>sttp.data.expressiontree</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for sttp.data.expressiontree</h1><div class="highlight"><pre>
<span></span><span class="c1"># ******************************************************************************************************</span>
<span class="c1">#  expressiontree.py - Gbtc</span>
<span class="c1">#</span>
<span class="c1">#  Copyright Â© 2022, Grid Protection Alliance.  All Rights Reserved.</span>
<span class="c1">#</span>
<span class="c1">#  Licensed to the Grid Protection Alliance (GPA) under one or more contributor license agreements. See</span>
<span class="c1">#  the NOTICE file distributed with this work for additional information regarding copyright ownership.</span>
<span class="c1">#  The GPA licenses this file to you under the MIT License (MIT), the &quot;License&quot;; you may not use this</span>
<span class="c1">#  file except in compliance with the License. You may obtain a copy of the License at:</span>
<span class="c1">#</span>
<span class="c1">#      http://opensource.org/licenses/MIT</span>
<span class="c1">#</span>
<span class="c1">#  Unless agreed to in writing, the subject software distributed under the License is distributed on an</span>
<span class="c1">#  &quot;AS-IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. Refer to the</span>
<span class="c1">#  License for the specific language governing permissions and limitations.</span>
<span class="c1">#</span>
<span class="c1">#  Code Modification History:</span>
<span class="c1">#  ----------------------------------------------------------------------------------------------------</span>
<span class="c1">#  09/04/2022 - J. Ritchie Carroll</span>
<span class="c1">#       Generated original version of source code.</span>
<span class="c1">#</span>
<span class="c1"># ******************************************************************************************************</span>

<span class="kn">from</span> <span class="nn">gsf</span> <span class="kn">import</span> <span class="n">Empty</span><span class="p">,</span> <span class="n">Limits</span><span class="p">,</span> <span class="n">normalize_enumname</span>
<span class="kn">from</span> <span class="nn">.datarow</span> <span class="kn">import</span> <span class="n">DataRow</span>
<span class="kn">from</span> <span class="nn">.datatable</span> <span class="kn">import</span> <span class="n">DataTable</span>
<span class="kn">from</span> <span class="nn">.datatype</span> <span class="kn">import</span> <span class="n">DataType</span>
<span class="kn">from</span> <span class="nn">.orderbyterm</span> <span class="kn">import</span> <span class="n">OrderByTerm</span>
<span class="kn">from</span> <span class="nn">.expression</span> <span class="kn">import</span> <span class="n">Expression</span>
<span class="kn">from</span> <span class="nn">.valueexpression</span> <span class="kn">import</span> <span class="n">ValueExpression</span><span class="p">,</span> \
    <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="n">EMPTYSTRINGVALUE</span><span class="p">,</span> \
    <span class="n">NULLBOOLVALUE</span><span class="p">,</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> \
    <span class="n">NULLINT32VALUE</span><span class="p">,</span> <span class="n">NULLDATETIMEVALUE</span>
<span class="kn">from</span> <span class="nn">.unaryexpression</span> <span class="kn">import</span> <span class="n">UnaryExpression</span>
<span class="kn">from</span> <span class="nn">.columnexpression</span> <span class="kn">import</span> <span class="n">ColumnExpression</span>
<span class="kn">from</span> <span class="nn">.inlistexpression</span> <span class="kn">import</span> <span class="n">InListExpression</span>
<span class="kn">from</span> <span class="nn">.functionexpression</span> <span class="kn">import</span> <span class="n">FunctionExpression</span>
<span class="kn">from</span> <span class="nn">.operatorexpression</span> <span class="kn">import</span> <span class="n">OperatorExpression</span>
<span class="kn">from</span> <span class="nn">.constants</span> <span class="kn">import</span> <span class="n">ExpressionType</span><span class="p">,</span> \
    <span class="n">ExpressionValueType</span><span class="p">,</span> <span class="n">ExpressionFunctionType</span><span class="p">,</span> \
    <span class="n">ExpressionOperatorType</span><span class="p">,</span> <span class="n">TimeInterval</span><span class="p">,</span> \
    <span class="n">is_integertype</span><span class="p">,</span> <span class="n">is_numerictype</span><span class="p">,</span> \
    <span class="n">derive_operationvaluetype</span><span class="p">,</span> \
    <span class="n">derive_comparison_operationvaluetype</span><span class="p">,</span> \
    <span class="n">derive_arithmetic_operationvaluetype</span>
<span class="kn">from</span> <span class="nn">.errors</span> <span class="kn">import</span> <span class="n">EvaluateError</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cmp_to_key</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">dateutil</span> <span class="kn">import</span> <span class="n">parser</span>
<span class="kn">from</span> <span class="nn">dateutil.relativedelta</span> <span class="kn">import</span> <span class="n">relativedelta</span>
<span class="kn">from</span> <span class="nn">uuid</span> <span class="kn">import</span> <span class="n">UUID</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">INTSIZE</span> <span class="o">=</span> <span class="mi">64</span> <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="k">else</span> <span class="mi">32</span>

<span class="n">UMAXINT64</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint64</span><span class="p">(</span><span class="n">Limits</span><span class="o">.</span><span class="n">MAXINT64</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_find_nthindex</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">source</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">test</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">location</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">break</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">location</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">result</span> <span class="o">-</span> <span class="mi">1</span>


<span class="k">def</span> <span class="nf">_split_nthindex</span><span class="p">(</span><span class="n">source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">test</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
    <span class="n">firstindex</span> <span class="o">=</span> <span class="n">_find_nthindex</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">secondindex</span> <span class="o">=</span> <span class="n">_find_nthindex</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">firstindex</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="k">if</span> <span class="n">secondindex</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">secondindex</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">secondindex</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">firstindex</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">source</span><span class="p">),</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">firstindex</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">test</span><span class="p">),</span> <span class="n">secondindex</span><span class="p">,</span> <span class="kc">True</span>


<div class="viewcode-block" id="ExpressionTree"><a class="viewcode-back" href="../../../sttp.data.html#sttp.data.expressiontree.ExpressionTree">[docs]</a><span class="k">class</span> <span class="nc">ExpressionTree</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Represents a tree of expressions for evaluation.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new expression tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataRow</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tablename</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Empty</span><span class="o">.</span><span class="n">STRING</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the associated table name parsed from &quot;FILTER&quot; statement, if any.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">toplimit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defined the parsed value associated with the &quot;TOP&quot; keyword, if any.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">orderbyterms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OrderByTerm</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Represents the order by elements parsed from the &quot;ORDER BY&quot; keyword, if any.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines the starting `Expression` for evaluation of the expression tree, or None if there</span>
<span class="sd">        is not one. This is the root expression of the `ExpressionTree`. Value is automatically</span>
<span class="sd">        managed by the `FilterExpressionParser`.</span>
<span class="sd">        &quot;&quot;&quot;</span>

<div class="viewcode-block" id="ExpressionTree.select"><a class="viewcode-back" href="../../../sttp.data.html#sttp.data.expressiontree.ExpressionTree.select">[docs]</a>    <span class="k">def</span> <span class="nf">select</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DataTable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">DataRow</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the rows matching the the `ExpressionTree`.</span>

<span class="sd">        The expression tree result type is expected to be a boolean for this filtering operation.</span>
<span class="sd">        This works like the &quot;WHERE&quot; clause of a SQL expression. Any &quot;TOP&quot; limit and &quot;ORDER BY&quot;</span>
<span class="sd">        sorting clauses found in filter expressions will be respected. An error will be returned</span>
<span class="sd">        if the table parameter is None, the expression tree does not yield a boolean value or any</span>
<span class="sd">        row expresssion evaluation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">predicate</span><span class="p">(</span><span class="n">result_expression</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
            <span class="c1"># Final expression should have a boolean data type (operates as a WHERE clause)</span>
            <span class="k">if</span> <span class="n">result_expression</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot execute select operation, final expression tree evaluation result must be a boolean value, not </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">normalize_enumname</span><span class="p">(</span><span class="n">result_expression</span><span class="o">.</span><span class="n">valuetype</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="c1"># If final result is Null, i.e., has no value due to Null propagation, treat result as False</span>
            <span class="k">return</span> <span class="n">result_expression</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">(),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">selectwhere</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">predicate</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="ExpressionTree.selectwhere"><a class="viewcode-back" href="../../../sttp.data.html#sttp.data.expressiontree.ExpressionTree.selectwhere">[docs]</a>    <span class="k">def</span> <span class="nf">selectwhere</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">DataTable</span><span class="p">,</span> <span class="n">predicate</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]],</span> <span class="n">applylimit</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span> <span class="n">applysort</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">DataRow</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns each table row evaluated from the `ExpressionTree` that matches the specified predicate.</span>

<span class="sd">        The `applylimit` and `applysort` parameters determine if any encountered &quot;TOP&quot; limit and &quot;ORDER BY&quot;</span>
<span class="sd">        sorting clauses will be respected. An error will be returned if the table parameter is nil or any</span>
<span class="sd">        row expresssion evaluation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;cannot execute select operation, table parameter cannot be None&quot;</span><span class="p">)</span>

        <span class="n">matchedrows</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">DataRow</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Find rows that match the expression tree</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">applylimit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">toplimit</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">matchedrows</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toplimit</span><span class="p">:</span>
                <span class="k">break</span>

            <span class="k">if</span> <span class="n">row</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">result_expression</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[],</span> <span class="n">err</span>

            <span class="c1"># If value result for row matches predicate expression, add it to matching rows</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">predicate</span><span class="p">(</span><span class="n">result_expression</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">[],</span> <span class="n">err</span>

            <span class="k">if</span> <span class="n">result</span><span class="p">:</span>
                <span class="n">matchedrows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

        <span class="c1"># Sort matching rows if requested</span>
        <span class="k">if</span> <span class="n">applysort</span> <span class="ow">and</span> <span class="n">matchedrows</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderbyterms</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">compare_rows</span><span class="p">(</span><span class="n">leftmatchedrow</span><span class="p">:</span> <span class="n">DataRow</span><span class="p">,</span> <span class="n">rightmatchedrow</span><span class="p">:</span> <span class="n">DataRow</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">orderbyterm</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">orderbyterms</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">orderbyterm</span><span class="o">.</span><span class="n">ascending</span><span class="p">:</span>
                        <span class="n">leftrow</span> <span class="o">=</span> <span class="n">leftmatchedrow</span>
                        <span class="n">rightrow</span> <span class="o">=</span> <span class="n">rightmatchedrow</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">leftrow</span> <span class="o">=</span> <span class="n">rightmatchedrow</span>
                        <span class="n">rightrow</span> <span class="o">=</span> <span class="n">leftmatchedrow</span>

                    <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">DataRow</span><span class="o">.</span><span class="n">compare_datarowcolumns</span><span class="p">(</span><span class="n">leftrow</span><span class="p">,</span> <span class="n">rightrow</span><span class="p">,</span> <span class="n">orderbyterm</span><span class="o">.</span><span class="n">column</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">orderbyterm</span><span class="o">.</span><span class="n">extactmatch</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot execute select operation, failed while comparing rows for sorting: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="c1"># If last compare result was equal, continue sort based on next order-by term</span>
                    <span class="k">if</span> <span class="n">result</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">result</span>

                <span class="k">return</span> <span class="mi">0</span>

            <span class="n">matchedrows</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">compare_rows</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">matchedrows</span><span class="p">,</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="ExpressionTree.evaluate"><a class="viewcode-back" href="../../../sttp.data.html#sttp.data.expressiontree.ExpressionTree.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DataRow</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Traverses the the `ExpressionTree` for the provided data row to produce a `ValueExpression`.</span>
<span class="sd">        Root expression should be assigned before calling `evaluate`; otherwise result will be a Null</span>
<span class="sd">        `ValueExpression`. The `datarow` parameter can be None if there are no columns referenced in</span>
<span class="sd">        expression tree. An error will be returned if the expresssion evaluation fails.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span> <span class="o">=</span> <span class="n">row</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expression</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">Expression</span><span class="p">,</span> <span class="n">ValueExpression</span><span class="p">]],</span> <span class="n">target_valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">expression</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">target_valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">expressiontype</span> <span class="o">=</span> <span class="n">expression</span><span class="o">.</span><span class="n">expressiontype</span>

        <span class="k">if</span> <span class="n">expressiontype</span> <span class="o">==</span> <span class="n">ExpressionType</span><span class="o">.</span><span class="n">VALUE</span><span class="p">:</span>
            <span class="c1"># Change Undefined NULL values to Nullable of target type</span>
            <span class="k">if</span> <span class="n">expression</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">target_valuetype</span><span class="p">),</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">expression</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">expressiontype</span> <span class="o">==</span> <span class="n">ExpressionType</span><span class="o">.</span><span class="n">UNARY</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_unary</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expressiontype</span> <span class="o">==</span> <span class="n">ExpressionType</span><span class="o">.</span><span class="n">COLUMN</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_column</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expressiontype</span> <span class="o">==</span> <span class="n">ExpressionType</span><span class="o">.</span><span class="n">INLIST</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_in_list</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expressiontype</span> <span class="o">==</span> <span class="n">ExpressionType</span><span class="o">.</span><span class="n">FUNCTION</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_function</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">expressiontype</span> <span class="o">==</span> <span class="n">ExpressionType</span><span class="o">.</span><span class="n">OPERATOR</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_operator</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected expression type encountered&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_unary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">unary_expression</span><span class="p">:</span> <span class="n">UnaryExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">unary_value</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">unary_expression</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating unary expression value: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">unary_valuetype</span> <span class="o">=</span> <span class="n">unary_value</span><span class="o">.</span><span class="n">valuetype</span>

        <span class="c1"># If unary value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">unary_value</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">unary_valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">unary_valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unary_expression</span><span class="o">.</span><span class="n">applyto_bool</span><span class="p">(</span><span class="n">unary_value</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">unary_valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unary_expression</span><span class="o">.</span><span class="n">applyto_int32</span><span class="p">(</span><span class="n">unary_value</span><span class="o">.</span><span class="n">_int32value</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">unary_valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unary_expression</span><span class="o">.</span><span class="n">applyto_int64</span><span class="p">(</span><span class="n">unary_value</span><span class="o">.</span><span class="n">_int64value</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">unary_valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unary_expression</span><span class="o">.</span><span class="n">applyto_decimal</span><span class="p">(</span><span class="n">unary_value</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">unary_valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">unary_expression</span><span class="o">.</span><span class="n">applyto_double</span><span class="p">(</span><span class="n">unary_value</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">())</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply unary </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">normalize_enumname</span><span class="p">(</span><span class="n">unary_expression</span><span class="o">.</span><span class="n">unarytype</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">normalize_enumname</span><span class="p">(</span><span class="n">unary_valuetype</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_column</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_expression</span><span class="p">:</span> <span class="n">ColumnExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>  <span class="c1"># sourcery skip</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;cannot evaluate column expression, current data row reference is not defined&quot;</span><span class="p">)</span>

        <span class="n">column</span> <span class="o">=</span> <span class="n">column_expression</span><span class="o">.</span><span class="n">datacolumn</span>

        <span class="k">if</span> <span class="n">column</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;cannot evaluate column expression, data column reference is not defined&quot;</span><span class="p">)</span>

        <span class="n">columnindex</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">index</span>
        <span class="n">columndatatype</span> <span class="o">=</span> <span class="n">column</span><span class="o">.</span><span class="n">datatype</span>

        <span class="k">if</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">stringvalue</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">booleanvalue</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">datetimevalue</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">SINGLE</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span>
            <span class="n">f32</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">singlevalue</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">f32</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">doublevalue</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">decimalvalue</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">GUID</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">GUID</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">guidvalue</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">INT8</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span>
            <span class="n">i8</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">int8value</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">i8</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">INT16</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span>
            <span class="n">i16</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">int16value</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">i16</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">int32value</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span>
            <span class="n">value</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">int64value</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT8</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span>
            <span class="n">ui8</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">uint8value</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">ui8</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT16</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span>
            <span class="n">ui16</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">uint16value</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">ui16</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT32</span><span class="p">:</span>
            <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span>
            <span class="n">ui32</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">uint32value</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">ui32</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">columndatatype</span> <span class="o">==</span> <span class="n">DataType</span><span class="o">.</span><span class="n">UINT64</span><span class="p">:</span>
            <span class="n">ui64</span><span class="p">,</span> <span class="n">isnull</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_currentrow</span><span class="o">.</span><span class="n">uint64value</span><span class="p">(</span><span class="n">columnindex</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ui64</span> <span class="o">&gt;</span> <span class="n">UMAXINT64</span><span class="p">:</span>
                <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">ui64</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">valuetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="n">ui64</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected column data type encountered&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">column</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> column </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">normalize_enumname</span><span class="p">(</span><span class="n">columndatatype</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> value for current row: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">isnull</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">valuetype</span><span class="p">,</span> <span class="n">value</span><span class="p">),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_evaluate_in_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">inlist_expression</span><span class="p">:</span> <span class="n">InListExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">inlist_value</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">inlist_expression</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IN</span><span class="se">\&quot;</span><span class="s2"> expression source value: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If in-list test value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">inlist_value</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">inlist_value</span><span class="o">.</span><span class="n">valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">has_notkeyword</span> <span class="o">=</span> <span class="n">inlist_expression</span><span class="o">.</span><span class="n">has_notkeyword</span>
        <span class="n">exactmatch</span> <span class="o">=</span> <span class="n">inlist_expression</span><span class="o">.</span><span class="n">exactmatch</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="n">inlist_expression</span><span class="o">.</span><span class="n">arguments</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)):</span>
            <span class="n">argument_value</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IN</span><span class="se">\&quot;</span><span class="s2"> expression argument </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> value: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">valuetype</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">derive_comparison_operationvaluetype</span><span class="p">(</span><span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">EQUAL</span><span class="p">,</span> <span class="n">inlist_value</span><span class="o">.</span><span class="n">valuetype</span><span class="p">,</span> <span class="n">argument_value</span><span class="o">.</span><span class="n">valuetype</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while deriving </span><span class="se">\&quot;</span><span class="s2">IN</span><span class="se">\&quot;</span><span class="s2"> expression argument </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> comparison operation value type: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_equal_op</span><span class="p">(</span><span class="n">inlist_value</span><span class="p">,</span> <span class="n">argument_value</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">,</span> <span class="n">exactmatch</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while comparing </span><span class="se">\&quot;</span><span class="s2">IN</span><span class="se">\&quot;</span><span class="s2"> expression source value to argument </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> for equality: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">FALSEVALUE</span> <span class="k">if</span> <span class="n">has_notkeyword</span> <span class="k">else</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">TRUEVALUE</span> <span class="k">if</span> <span class="n">has_notkeyword</span> <span class="k">else</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_evaluate_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_expression</span><span class="p">:</span> <span class="n">FunctionExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">functiontype</span> <span class="o">=</span> <span class="n">function_expression</span><span class="o">.</span><span class="n">functiontype</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="n">function_expression</span><span class="o">.</span><span class="n">arguments</span>

        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">ABS</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_abs</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">CEILING</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_ceiling</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">COALESCE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_coalesce</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">CONVERT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_convert</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">CONTAINS</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_contains</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">DATEADD</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_dateadd</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">DATEDIFF</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_datediff</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">DATEPART</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_datepart</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">ENDSWITH</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_endswith</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">FLOOR</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_floor</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">IIF</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_iif</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">INDEXOF</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_indexof</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">ISDATE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_is_date</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">ISINTEGER</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_is_integer</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">ISGUID</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_is_guid</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">ISNULL</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_is_null</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">ISNUMERIC</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_is_numeric</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">LASTINDEXOF</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_lastindexof</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">LEN</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">LOWER</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_lower</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">MAXOF</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_maxof</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">MINOF</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_minof</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">NTHINDEXOF</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_nthindexof</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">NOW</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_now</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">POWER</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_power</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">REGEXMATCH</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_regexmatch</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">REGEXVAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_regexval</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">REPLACE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_replace</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">REVERSE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_reverse</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">ROUND</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_round</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">SPLIT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_split</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">SQRT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_sqrt</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">STARTSWITH</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_startswith</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">STRCOUNT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_strcount</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">STRCMP</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_strcmp</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">SUBSTR</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_substr</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">TRIM</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_trim</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">TRIMLEFT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_trimleft</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">TRIMRIGHT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_trimright</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">UPPER</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_upper</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">functiontype</span> <span class="o">==</span> <span class="n">ExpressionFunctionType</span><span class="o">.</span><span class="n">UTCNOW</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_utcnow</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected function type encountered&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_abs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Abs</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Abs</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_abs</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_ceiling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Ceiling</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Ceiling</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ceiling</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_coalesce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Coalesce</span><span class="se">\&quot;</span><span class="s2"> function expects at least 2 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Not pre-evaluating Coalesce arguments - arguments will be evaluated only up to first non-null value</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_coalesce</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Convert</span><span class="se">\&quot;</span><span class="s2"> function expects 2 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Convert</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">targettype</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Convert</span><span class="se">\&quot;</span><span class="s2"> function target type, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">targettype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Contains</span><span class="se">\&quot;</span><span class="s2"> function expects 2 or 3 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Contains</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Contains</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contains</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">NULLBOOLVALUE</span><span class="p">)</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Contains</span><span class="se">\&quot;</span><span class="s2"> function optional ignore case value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_contains</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_dateadd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DateAdd</span><span class="se">\&quot;</span><span class="s2"> function expects 3 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">DateAdd</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">addvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">DateAdd</span><span class="se">\&quot;</span><span class="s2"> function add value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">intervaltype</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">DateAdd</span><span class="se">\&quot;</span><span class="s2"> function interval type value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dateadd</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">addvalue</span><span class="p">,</span> <span class="n">intervaltype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_datediff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DateDiff</span><span class="se">\&quot;</span><span class="s2"> function expects 3 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">DateDiff</span><span class="se">\&quot;</span><span class="s2"> function left value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">DateDiff</span><span class="se">\&quot;</span><span class="s2"> function right value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">intervaltype</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">DateDiff</span><span class="se">\&quot;</span><span class="s2"> function interval type value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datediff</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">intervaltype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_datepart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DatePart</span><span class="se">\&quot;</span><span class="s2"> function expects 2 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">DatePart</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">intervaltype</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">DatePart</span><span class="se">\&quot;</span><span class="s2"> function interval type value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datepart</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">intervaltype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_endswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">EndsWith</span><span class="se">\&quot;</span><span class="s2"> function expects 2 or 3 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">EndsWith</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">EndsWith</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endswith</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">NULLBOOLVALUE</span><span class="p">)</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">EndsWith</span><span class="se">\&quot;</span><span class="s2"> function optional ignore case value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_endswith</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_floor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Floor</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Floor</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_floor</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_iif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IIf</span><span class="se">\&quot;</span><span class="s2"> function expects 3 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IIf</span><span class="se">\&quot;</span><span class="s2"> function test value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Not pre-evaluating IIf result value arguments - only evaluating desired path</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_iif</span><span class="p">(</span><span class="n">testvalue</span><span class="p">,</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_evaluate_indexof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IndexOf</span><span class="se">\&quot;</span><span class="s2"> function expects 2 or 3 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IndexOf</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IndexOf</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexof</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">NULLBOOLVALUE</span><span class="p">)</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IndexOf</span><span class="se">\&quot;</span><span class="s2"> function optional ignore case value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_indexof</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_is_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IsDate</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IsDate</span><span class="se">\&quot;</span><span class="s2"> function test value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_date</span><span class="p">(</span><span class="n">testvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_is_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IsInteger</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IsInteger</span><span class="se">\&quot;</span><span class="s2"> function test value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_integer</span><span class="p">(</span><span class="n">testvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_is_guid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IsGuid</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IsGuid</span><span class="se">\&quot;</span><span class="s2"> function test value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_guid</span><span class="p">(</span><span class="n">testvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_is_null</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IsNull</span><span class="se">\&quot;</span><span class="s2"> function expects 2 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IsNull</span><span class="se">\&quot;</span><span class="s2"> function test value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">defaultvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IsNull</span><span class="se">\&quot;</span><span class="s2"> function default value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_null</span><span class="p">(</span><span class="n">testvalue</span><span class="p">,</span> <span class="n">defaultvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_is_numeric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IsNumeric</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IsNumeric</span><span class="se">\&quot;</span><span class="s2"> function test value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_numeric</span><span class="p">(</span><span class="n">testvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_lastindexof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">LastIndexOf</span><span class="se">\&quot;</span><span class="s2"> function expects 2 or 3 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">LastIndexOf</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">LastIndexOf</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastindexof</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">NULLBOOLVALUE</span><span class="p">)</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">LastIndexOf</span><span class="se">\&quot;</span><span class="s2"> function optional ignore case value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lastindexof</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Len</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Len</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_len</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_lower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Lower</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Lower</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lower</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_maxof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">MaxOf</span><span class="se">\&quot;</span><span class="s2"> function expects at least 2 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_maxof</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_minof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">MinOf</span><span class="se">\&quot;</span><span class="s2"> function expects at least 2 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_minof</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_nthindexof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">NthIndexOf</span><span class="se">\&quot;</span><span class="s2"> function expects 3 or 4 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">NthIndexOf</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">NthIndexOf</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">indexvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">NthIndexOf</span><span class="se">\&quot;</span><span class="s2"> function index value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nthindexof</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">indexvalue</span><span class="p">,</span> <span class="n">NULLBOOLVALUE</span><span class="p">)</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">NthIndexOf</span><span class="se">\&quot;</span><span class="s2"> function optional ignore case value, fourth argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_nthindexof</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">indexvalue</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_now</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Now</span><span class="se">\&quot;</span><span class="s2"> function expects 0 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_now</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_evaluate_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Power</span><span class="se">\&quot;</span><span class="s2"> function expects 2 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Power</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">exponentvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Power</span><span class="se">\&quot;</span><span class="s2"> function exponent value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_power</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">exponentvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_regexmatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">RegExMatch</span><span class="se">\&quot;</span><span class="s2"> function expects 2 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">regexvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">RegExMatch</span><span class="se">\&quot;</span><span class="s2"> function expression value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">RegExMatch</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regexmatch</span><span class="p">(</span><span class="n">regexvalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_regexval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">RegExValue</span><span class="se">\&quot;</span><span class="s2"> function expects 2 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">regexvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">RegExValue</span><span class="se">\&quot;</span><span class="s2"> function expression value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">RegExValue</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_regexval</span><span class="p">(</span><span class="n">regexvalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function expects 3 or 4 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">replacevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function replace value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">replacevalue</span><span class="p">,</span> <span class="n">NULLBOOLVALUE</span><span class="p">)</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function optional ignore case value, fourth argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_replace</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">replacevalue</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Reverse</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Reverse</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_reverse</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Round</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Round</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Split</span><span class="se">\&quot;</span><span class="s2"> function expects 3 or 4 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Split</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">delimitervalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Split</span><span class="se">\&quot;</span><span class="s2"> function delimiter value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">indexvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Split</span><span class="se">\&quot;</span><span class="s2"> function index value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">delimitervalue</span><span class="p">,</span> <span class="n">indexvalue</span><span class="p">,</span> <span class="n">NULLBOOLVALUE</span><span class="p">)</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Split</span><span class="se">\&quot;</span><span class="s2"> function optional ignore case value, fourth argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_split</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">delimitervalue</span><span class="p">,</span> <span class="n">indexvalue</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Sqrt</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Sqrt</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sqrt</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_startswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">StartsWith</span><span class="se">\&quot;</span><span class="s2"> function expects 2 or 3 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">StartsWith</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">StartsWith</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startswith</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">NULLBOOLVALUE</span><span class="p">)</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">StartsWith</span><span class="se">\&quot;</span><span class="s2"> function optional ignore case value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_startswith</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_strcount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">StrCount</span><span class="se">\&quot;</span><span class="s2"> function expects 2 or 3 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">StrCount</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">StrCount</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strcount</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">NULLBOOLVALUE</span><span class="p">)</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">StrCount</span><span class="se">\&quot;</span><span class="s2"> function optional ignore case value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strcount</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_strcmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">StrCmp</span><span class="se">\&quot;</span><span class="s2"> function expects 2 or 3 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">StrCmp</span><span class="se">\&quot;</span><span class="s2"> function left value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">StrCmp</span><span class="se">\&quot;</span><span class="s2"> function right value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strcmp</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">NULLBOOLVALUE</span><span class="p">)</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">StrCmp</span><span class="se">\&quot;</span><span class="s2"> function optional ignore case value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strcmp</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_substr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">SubStr</span><span class="se">\&quot;</span><span class="s2"> function expects 2 or 3 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">SubStr</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">indexvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">SubStr</span><span class="se">\&quot;</span><span class="s2"> function index value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_substr</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">indexvalue</span><span class="p">,</span> <span class="n">NULLINT32VALUE</span><span class="p">)</span>

        <span class="n">lengthvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">SubStr</span><span class="se">\&quot;</span><span class="s2"> function optional length value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_substr</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">indexvalue</span><span class="p">,</span> <span class="n">lengthvalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Trim</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Trim</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trim</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_trimleft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">TrimLeft</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">TrimLeft</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trimleft</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_trimright</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">TrimRight</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">TrimRight</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trimright</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_upper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Upper</span><span class="se">\&quot;</span><span class="s2"> function expects 1 argument, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Upper</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upper</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluate_utcnow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">UtcNow</span><span class="se">\&quot;</span><span class="s2"> function expects 0 arguments, received </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utcnow</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_evaluate_operator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">operator_expression</span><span class="p">:</span> <span class="n">OperatorExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">operatortype</span> <span class="o">=</span> <span class="n">operator_expression</span><span class="o">.</span><span class="n">operatortype</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">operator_expression</span><span class="o">.</span><span class="n">leftvalue</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">normalize_enumname</span><span class="p">(</span><span class="n">operatortype</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> operator left operand: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">operator_expression</span><span class="o">.</span><span class="n">rightvalue</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">normalize_enumname</span><span class="p">(</span><span class="n">operatortype</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> operator right operand: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">valuetype</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">derive_operationvaluetype</span><span class="p">(</span><span class="n">operatortype</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">,</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while deriving </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">normalize_enumname</span><span class="p">(</span><span class="n">operatortype</span><span class="p">)</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> operator value type: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">MULTIPLY</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_multiply_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">DIVIDE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_divide_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">MODULUS</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_modulus_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">ADD</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_add_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">SUBTRACT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_subtract_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">BITSHIFTLEFT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bitshiftleft_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">BITSHIFTRIGHT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bitshiftright_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">BITWISEAND</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bitwiseand_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">BITWISEOR</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bitwiseor_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">BITWISEXOR</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bitwisexor_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">LESSTHAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lessthan_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">LESSTHANOREQUAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lessthanorequal_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">GREATERTHAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_greaterthan_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">GREATERTHANOREQUAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_greaterthanorequal_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">EQUAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_equal_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">EQUALEXACTMATCH</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_equal_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">NOTEQUAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notequal_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">NOTEQUALEXACTMATCH</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notequal_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">ISNULL</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isnull_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">ISNOTNULL</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_isnotnull_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">LIKE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_like_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">LIKEEXACTMATCH</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_like_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">NOTLIKE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notlike_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">NOTLIKEEXACTMATCH</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notlike_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">AND</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_and_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">operatortype</span> <span class="o">==</span> <span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">OR</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_or_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected operator type encountered&quot;</span><span class="p">)</span>

    <span class="c1"># Filter Expression Function Implementations</span>

    <span class="k">def</span> <span class="nf">_abs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">sourcevaluetype</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_numerictype</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Abs</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a numeric type&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">())),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">())),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">())),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected expression value type encountered&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ceiling</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">sourcevaluetype</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_numerictype</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Ceiling</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a numeric type&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">is_integertype</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sourcevalue</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">())),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected expression value type encountered&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_coalesce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Coalesce</span><span class="se">\&quot;</span><span class="s2"> function argument 0: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">testvalue</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)):</span>
            <span class="n">listvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">Coalesce</span><span class="se">\&quot;</span><span class="s2"> function argument </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">listvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">listvalue</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">testvalue</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_convert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">targettype</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">targettype</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Convert</span><span class="se">\&quot;</span><span class="s2"> function target type, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">targettype</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Convert</span><span class="se">\&quot;</span><span class="s2"> function target type, second argument, is null&quot;</span><span class="p">)</span>

        <span class="n">targettypename</span> <span class="o">=</span> <span class="n">targettype</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>

        <span class="c1"># Remove any &quot;System.&quot; prefix:</span>
        <span class="n">targettypename</span> <span class="o">=</span> <span class="n">targettypename</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s2">&quot;SYSTEM.&quot;</span><span class="p">)</span>

        <span class="n">targetvaluetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">UNDEFINED</span>
        <span class="n">foundvaluetype</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">valuetype</span> <span class="ow">in</span> <span class="n">ExpressionValueType</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">targettypename</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">valuetype</span><span class="p">)</span><span class="o">.</span><span class="n">removeprefix</span><span class="p">(</span><span class="s2">&quot;ExpressionValueType.&quot;</span><span class="p">):</span>
                <span class="n">targetvaluetype</span> <span class="o">=</span> <span class="n">valuetype</span>
                <span class="n">foundvaluetype</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">foundvaluetype</span><span class="p">:</span>
            <span class="c1"># Handle a few common aliases</span>
            <span class="k">if</span> <span class="n">targettypename</span> <span class="o">==</span> <span class="s2">&quot;SINGLE&quot;</span> <span class="ow">or</span> <span class="n">targettypename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;FLOAT&quot;</span><span class="p">):</span>
                <span class="n">targetvaluetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span>
                <span class="n">foundvaluetype</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">targettypename</span> <span class="o">==</span> <span class="s2">&quot;BOOL&quot;</span><span class="p">:</span>
                <span class="n">targetvaluetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span>
                <span class="n">foundvaluetype</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">targettypename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;INT&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">targettypename</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;UINT&quot;</span><span class="p">):</span>
                <span class="n">targetvaluetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span>
                <span class="n">foundvaluetype</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">targettypename</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;DATE&quot;</span><span class="p">,</span> <span class="s2">&quot;TIME&quot;</span><span class="p">]:</span>
                <span class="n">targetvaluetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span>
                <span class="n">foundvaluetype</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">elif</span> <span class="n">targettypename</span> <span class="o">==</span> <span class="s2">&quot;UUID&quot;</span><span class="p">:</span>
                <span class="n">targetvaluetype</span> <span class="o">=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">GUID</span>
                <span class="n">foundvaluetype</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">foundvaluetype</span> <span class="ow">or</span> <span class="n">targetvaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">UNDEFINED</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;specified </span><span class="se">\&quot;</span><span class="s2">Convert</span><span class="se">\&quot;</span><span class="s2"> function target type </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">targettype</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">, second argument, is not supported&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">targetvaluetype</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_contains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Contains</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Contains</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLBOOLVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">Contains</span><span class="se">\&quot;</span><span class="s2"> function ignore case, third argument, to a </span><span class="se">\&quot;</span><span class="s2">Boolean</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span> <span class="ow">in</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_dateadd</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">addvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">intervaltype</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DateAdd</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">DateTime</span><span class="se">\&quot;</span><span class="s2"> or a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_integertype</span><span class="p">(</span><span class="n">addvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DateAdd</span><span class="se">\&quot;</span><span class="s2"> function add value, second argument, must be an integer type&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">intervaltype</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DateAdd</span><span class="se">\&quot;</span><span class="s2"> function interval type, third argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">addvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DateAdd</span><span class="se">\&quot;</span><span class="s2"> function add value second argument, is null&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">intervaltype</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DateAdd</span><span class="se">\&quot;</span><span class="s2"> function interval type, third argument, is null&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLDATETIMEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># DateTime parameters should support strings as well as literals</span>
        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">DateAdd</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, to a </span><span class="se">\&quot;</span><span class="s2">DateTime</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">interval</span> <span class="o">=</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">intervaltype</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="s2">&quot;failed while parsing </span><span class="se">\&quot;</span><span class="s2">DateAdd</span><span class="se">\&quot;</span><span class="s2"> function interval type, third argument, as a valid time interval&quot;</span><span class="p">)</span>

        <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">addvalue</span><span class="o">.</span><span class="n">integervalue</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">YEAR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">years</span><span class="o">=</span><span class="n">value</span><span class="p">)),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">MONTH</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="n">value</span><span class="p">)),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TimeInterval</span><span class="o">.</span><span class="n">DAYOFYEAR</span><span class="p">,</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">DAY</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">value</span><span class="p">)),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">WEEKDAY</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">weekday</span><span class="o">=</span><span class="n">value</span><span class="p">)),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">WEEK</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="n">value</span><span class="p">)),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">HOUR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">value</span><span class="p">)),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">MINUTE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">value</span><span class="p">)),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">SECOND</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="n">value</span><span class="p">)),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">MILLISECOND</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">microseconds</span><span class="o">=</span><span class="n">value</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">)),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected time interval encountered&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_datediff</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">intervaltype</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># sourcery skip</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DateDiff</span><span class="se">\&quot;</span><span class="s2"> function left value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">DateTime</span><span class="se">\&quot;</span><span class="s2"> or a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DateDiff</span><span class="se">\&quot;</span><span class="s2"> function right value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">DateTime</span><span class="se">\&quot;</span><span class="s2"> or a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">intervaltype</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DateDiff</span><span class="se">\&quot;</span><span class="s2"> function interval type, third argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">intervaltype</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DateDiff</span><span class="se">\&quot;</span><span class="s2"> function interval type, third argument, is null&quot;</span><span class="p">)</span>

        <span class="c1"># If either test value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLINT32VALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># DateTime parameters should support strings as well as literals</span>
        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">DateDiff</span><span class="se">\&quot;</span><span class="s2"> function left value, first argument, to a </span><span class="se">\&quot;</span><span class="s2">DateTime</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">DateDiff</span><span class="se">\&quot;</span><span class="s2"> function right value, second argument, to a </span><span class="se">\&quot;</span><span class="s2">DateTime</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">interval</span> <span class="o">=</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">intervaltype</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="s2">&quot;failed while parsing </span><span class="se">\&quot;</span><span class="s2">DateDiff</span><span class="se">\&quot;</span><span class="s2"> function interval type, third argument, as a valid time interval&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">interval</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TimeInterval</span><span class="o">.</span><span class="n">YEAR</span><span class="p">,</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">MONTH</span><span class="p">]:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">relativedelta</span><span class="p">(</span><span class="n">rightvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">(),</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">YEAR</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">delta</span><span class="o">.</span><span class="n">years</span><span class="p">),</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">delta</span><span class="o">.</span><span class="n">months</span> <span class="o">+</span> <span class="p">(</span><span class="mi">12</span> <span class="o">*</span> <span class="n">delta</span><span class="o">.</span><span class="n">years</span><span class="p">)),</span> <span class="kc">None</span>

        <span class="n">delta</span> <span class="o">=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">-</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">interval</span> <span class="ow">in</span> <span class="p">[</span><span class="n">TimeInterval</span><span class="o">.</span><span class="n">DAYOFYEAR</span><span class="p">,</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">DAY</span><span class="p">,</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">WEEKDAY</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">delta</span><span class="o">.</span><span class="n">days</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">WEEK</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">delta</span><span class="o">.</span><span class="n">days</span> <span class="o">//</span> <span class="mi">7</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">HOUR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span> <span class="o">//</span> <span class="mi">3600</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">MINUTE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span> <span class="o">//</span> <span class="mi">60</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">SECOND</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">MILLISECOND</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">delta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">())</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">+</span> <span class="n">delta</span><span class="o">.</span><span class="n">microseconds</span> <span class="o">//</span> <span class="mi">1000</span><span class="p">),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected time interval encountered&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_datepart</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">intervaltype</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DatePart</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">DateTime</span><span class="se">\&quot;</span><span class="s2"> or a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">intervaltype</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DatePart</span><span class="se">\&quot;</span><span class="s2"> function interval type, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">intervaltype</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">DatePart</span><span class="se">\&quot;</span><span class="s2"> function interval type, second argument, is null&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLINT32VALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># DateTime parameters should support strings as well as literals</span>
        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">DatePart</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, to a </span><span class="se">\&quot;</span><span class="s2">DateTime</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">interval</span> <span class="o">=</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">intervaltype</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())</span>

        <span class="k">if</span> <span class="n">interval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while parsing </span><span class="se">\&quot;</span><span class="s2">DatePart</span><span class="se">\&quot;</span><span class="s2"> function interval type, second argument, as a valid time interval&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">YEAR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">MONTH</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span><span class="o">.</span><span class="n">month</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">DAYOFYEAR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span><span class="o">.</span><span class="n">timetuple</span><span class="p">()</span><span class="o">.</span><span class="n">tm_yday</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">DAY</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span><span class="o">.</span><span class="n">day</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">WEEKDAY</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span><span class="o">.</span><span class="n">weekday</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span><span class="p">),</span> <span class="kc">None</span>  <span class="c1"># Starts on Monday at zero</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">WEEK</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span><span class="o">.</span><span class="n">isocalendar</span><span class="p">()[</span><span class="mi">1</span><span class="p">]),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">HOUR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span><span class="o">.</span><span class="n">hour</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">MINUTE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span><span class="o">.</span><span class="n">minute</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">SECOND</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span><span class="o">.</span><span class="n">second</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">interval</span> <span class="o">==</span> <span class="n">TimeInterval</span><span class="o">.</span><span class="n">MILLISECOND</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span><span class="o">.</span><span class="n">microsecond</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected time interval encountered&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_endswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">EndsWith</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">EndsWith</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLBOOLVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">EndsWith</span><span class="se">\&quot;</span><span class="s2"> function ignore case, third argument, to a </span><span class="se">\&quot;</span><span class="s2">Boolean</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_floor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">sourcevaluetype</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_numerictype</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Floor</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a numeric type&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">is_integertype</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sourcevalue</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">())),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected expression value type encountered&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_iif</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">truevalue</span><span class="p">:</span> <span class="n">Expression</span><span class="p">,</span> <span class="n">falsevalue</span><span class="p">:</span> <span class="n">Expression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>  <span class="c1"># sourcery skip</span>
        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IIf</span><span class="se">\&quot;</span><span class="s2"> function test value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">Boolean</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Null test expression evaluates to false, that is, false value expression</span>
        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
            <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">truevalue</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IIf</span><span class="se">\&quot;</span><span class="s2"> function true value, second argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">falsevalue</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">IIf</span><span class="se">\&quot;</span><span class="s2"> function false value, third argument: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_indexof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IndexOf</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IndexOf</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IndexOf</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, is null&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLINT32VALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">IndexOf</span><span class="se">\&quot;</span><span class="s2"> function ignore case, third argument, to a </span><span class="se">\&quot;</span><span class="s2">Boolean</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_is_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">parser</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())</span>
                <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_is_integer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">is_integertype</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span>

            <span class="c1"># Shortcut for unsigned ints</span>
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
                <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;X&quot;</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>

                <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_is_guid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">GUID</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">UUID</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())</span>
                <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_is_null</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">defaultvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">defaultvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">IsNull</span><span class="se">\&quot;</span><span class="s2"> function default value, second argument, is null&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">defaultvalue</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="n">testvalue</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_is_numeric</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">is_numerictype</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())</span>
                <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_lastindexof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">LastIndexOf</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">LastIndexOf</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">LastIndexOf</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, is null&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLINT32VALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">LastIndexOf</span><span class="se">\&quot;</span><span class="s2"> function ignore case, third argument, to a </span><span class="se">\&quot;</span><span class="s2">Boolean</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_len</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Len</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLINT32VALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_lower</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Lower</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_maxof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">MaxOf</span><span class="se">\&quot;</span><span class="s2"> function argument 0: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)):</span>
            <span class="n">nextvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">MaxOf</span><span class="se">\&quot;</span><span class="s2"> function argument </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">valuetype</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">derive_comparison_operationvaluetype</span><span class="p">(</span><span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">GREATERTHAN</span><span class="p">,</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">,</span> <span class="n">nextvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while deriving </span><span class="se">\&quot;</span><span class="s2">MaxOf</span><span class="se">\&quot;</span><span class="s2"> function greater than comparison operator value type: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_greaterthan_op</span><span class="p">(</span><span class="n">nextvalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">MaxOf</span><span class="se">\&quot;</span><span class="s2"> function greater than comparison operator: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">nextvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()):</span>
                <span class="n">testvalue</span> <span class="o">=</span> <span class="n">nextvalue</span>

        <span class="k">return</span> <span class="n">testvalue</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_minof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arguments</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">testvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">MinOf</span><span class="se">\&quot;</span><span class="s2"> function argument 0: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)):</span>
            <span class="n">nextvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">MinOf</span><span class="se">\&quot;</span><span class="s2"> function argument </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">valuetype</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">derive_comparison_operationvaluetype</span><span class="p">(</span><span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">LESSTHAN</span><span class="p">,</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">,</span> <span class="n">nextvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while deriving </span><span class="se">\&quot;</span><span class="s2">MinOf</span><span class="se">\&quot;</span><span class="s2"> function greater than comparison operator value type: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">result</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lessthan_op</span><span class="p">(</span><span class="n">nextvalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="s2">MinOf</span><span class="se">\&quot;</span><span class="s2"> function greater than comparison operator: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">()</span> <span class="ow">or</span> <span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">nextvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()):</span>
                <span class="n">testvalue</span> <span class="o">=</span> <span class="n">nextvalue</span>

        <span class="k">return</span> <span class="n">testvalue</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_now</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_nthindexof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">indexvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">NthIndexOf</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">NthIndexOf</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">NthIndexOf</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, is null&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">indexvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">NthIndexOf</span><span class="se">\&quot;</span><span class="s2"> function index value, third argument, is null&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLINT32VALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">NthIndexOf</span><span class="se">\&quot;</span><span class="s2"> function ignore case, fourth argument, to a </span><span class="se">\&quot;</span><span class="s2">Boolean</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span>
            <span class="n">test</span> <span class="o">=</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">ExpressionTree</span><span class="o">.</span><span class="n">_find_nthindex</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">test</span><span class="p">,</span> <span class="n">indexvalue</span><span class="o">.</span><span class="n">integervalue</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_power</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">exponentvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_numerictype</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Power</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a numeric type&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_numerictype</span><span class="p">(</span><span class="n">exponentvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Power</span><span class="se">\&quot;</span><span class="s2"> function exponent value, second argument, must be a numeric type&quot;</span><span class="p">)</span>

        <span class="c1"># If source value or exponent value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">exponentvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">valuetype</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">derive_arithmetic_operationvaluetype</span><span class="p">(</span><span class="n">ExpressionOperatorType</span><span class="o">.</span><span class="n">MULTIPLY</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">,</span> <span class="n">exponentvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while deriving </span><span class="se">\&quot;</span><span class="s2">Power</span><span class="se">\&quot;</span><span class="s2"> function multiplicative arithmetic operation value type: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">Power</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">exponentvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">exponentvalue</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">Power</span><span class="se">\&quot;</span><span class="s2"> function exponent value, second argument, to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">(),</span> <span class="n">exponentvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">())</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">(),</span> <span class="n">exponentvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">())),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">(),</span> <span class="n">exponentvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">())),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">(),</span> <span class="n">exponentvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">())),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">pow</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">(),</span> <span class="n">exponentvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected expression value type encountered&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_regexmatch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regexvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluateregex</span><span class="p">(</span><span class="s2">&quot;RegExMatch&quot;</span><span class="p">,</span> <span class="n">regexvalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_regexval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">regexvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluateregex</span><span class="p">(</span><span class="s2">&quot;RegExVal&quot;</span><span class="p">,</span> <span class="n">regexvalue</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_evaluateregex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">functionname</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">regexvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">return_matchedvalue</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">regexvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="si">{</span><span class="n">functionname</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> function regular expression value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="si">{</span><span class="n">functionname</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If regular expression value or test value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">regexvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">return_matchedvalue</span> <span class="k">else</span> <span class="p">(</span><span class="n">NULLBOOLVALUE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">regexvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">(),</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">return_matchedvalue</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">(</span><span class="n">EMPTYSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">match</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="kc">None</span><span class="p">)</span>

            <span class="k">return</span> <span class="p">(</span><span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">(</span><span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while evaluating </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">functionname</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> function expression value, first argument: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">replacevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">replacevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function replace value, third argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, is null&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">replacevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function replace value, third argument, is null&quot;</span><span class="p">)</span>

        <span class="c1"># If source value, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function ignore case value, fourth argument, to </span><span class="se">\&quot;</span><span class="s2">Boolean</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">regex</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()),</span> <span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while compiling </span><span class="se">\&quot;</span><span class="s2">Replace</span><span class="se">\&quot;</span><span class="s2"> function case-insensitive RegEx replace expression for test value, second argument: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">regex</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">replacevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">(),</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">(),</span> <span class="n">replacevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_reverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Reverse</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If source value, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_round</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">sourcevaluetype</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_numerictype</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Round</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a numeric type&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">is_integertype</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sourcevalue</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span><span class="o">.</span><span class="n">quantize</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="nb">round</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected expression value type encountered&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_split</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">delimitervalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">indexvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Split</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">delimitervalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Split</span><span class="se">\&quot;</span><span class="s2"> function delimiter value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_integertype</span><span class="p">(</span><span class="n">indexvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Split</span><span class="se">\&quot;</span><span class="s2"> function index value, third argument, must be an integer type&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">delimitervalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Split</span><span class="se">\&quot;</span><span class="s2"> function delimiter value, second argument, is null&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">indexvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Split</span><span class="se">\&quot;</span><span class="s2"> function index value, third argument, is null&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">Split</span><span class="se">\&quot;</span><span class="s2"> function ignore case value, fourth argument, to </span><span class="se">\&quot;</span><span class="s2">Boolean</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">sourcevalue</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">indexvalue</span><span class="o">.</span><span class="n">_integervalue</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">_split_nthindex</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">delimitervalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">index</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">success</span> <span class="o">=</span> <span class="n">_split_nthindex</span><span class="p">(</span><span class="n">sourcevalue</span><span class="p">,</span> <span class="n">delimitervalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">(),</span> <span class="n">index</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">stop</span><span class="p">]),</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">success</span> <span class="k">else</span> <span class="p">(</span><span class="n">EMPTYSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="n">sourcevaluetype</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_numerictype</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Sqrt</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a numeric type&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">is_integertype</span><span class="p">(</span><span class="n">sourcevaluetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">integervalue</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">sourcevaluetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sourcevalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;unexpected expression value type encountered&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_startswith</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">StartsWith</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">StartsWith</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">StartsWith</span><span class="se">\&quot;</span><span class="s2"> function ignore case value, third argument, to </span><span class="se">\&quot;</span><span class="s2">Boolean</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_strcount</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">testvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">StrCount</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">StrCount</span><span class="se">\&quot;</span><span class="s2"> function test value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">findvalue</span> <span class="o">=</span> <span class="n">testvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">findvalue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">StrCount</span><span class="se">\&quot;</span><span class="s2"> function ignore case value, third argument, to </span><span class="se">\&quot;</span><span class="s2">Boolean</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">findvalue</span><span class="o">.</span><span class="n">upper</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">findvalue</span><span class="p">)),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_strcmp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">ignorecase</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">StrCmp</span><span class="se">\&quot;</span><span class="s2"> function left value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">StrCmp</span><span class="se">\&quot;</span><span class="s2"> function right value, second argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">ignorecase</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;failed while converting </span><span class="se">\&quot;</span><span class="s2">StrCmp</span><span class="se">\&quot;</span><span class="s2"> function ignore case value, third argument, to </span><span class="se">\&quot;</span><span class="s2">Boolean</span><span class="se">\&quot;</span><span class="s2">: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">compare_str</span><span class="p">(</span><span class="n">left</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">right</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">left</span> <span class="o">&lt;</span> <span class="n">right</span> <span class="k">else</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">left</span> <span class="o">&gt;</span> <span class="n">right</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">ignorecase</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">compare_str</span><span class="p">(</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">())),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">compare_str</span><span class="p">(</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">(),</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">())),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_substr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">indexvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">lengthvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">SubStr</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_integertype</span><span class="p">(</span><span class="n">indexvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">SubStr</span><span class="se">\&quot;</span><span class="s2"> function index value, second argument, must be an integer type&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_integertype</span><span class="p">(</span><span class="n">lengthvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">SubStr</span><span class="se">\&quot;</span><span class="s2"> function length value, third argument, must be an integer type&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">sourcetext</span> <span class="o">=</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">indexvalue</span><span class="o">.</span><span class="n">integervalue</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sourcetext</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">EMPTYSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">lengthvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="n">length</span> <span class="o">=</span> <span class="n">lengthvalue</span><span class="o">.</span><span class="n">integervalue</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">length</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">EMPTYSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">index</span> <span class="o">+</span> <span class="n">length</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sourcetext</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">sourcetext</span><span class="p">[</span><span class="n">index</span><span class="p">:</span><span class="n">index</span> <span class="o">+</span> <span class="n">length</span><span class="p">]),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">sourcetext</span><span class="p">[</span><span class="n">index</span><span class="p">:]),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_trim</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Trim</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_trimleft</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">TrimLeft</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_trimright</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">TrimRight</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_upper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">Upper</span><span class="se">\&quot;</span><span class="s2"> function source value, first argument, must be a </span><span class="se">\&quot;</span><span class="s2">String</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># If source value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLSTRINGVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">sourcevalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_utcnow</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">,</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">)),</span> <span class="kc">None</span>

    <span class="c1"># Filter Expression Operator Implementations</span>

    <span class="k">def</span> <span class="nf">_convert_operands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># sourcery skip</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">err</span>

        <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">err</span>

        <span class="k">return</span> <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_multiply_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;multiplication </span><span class="se">\&quot;</span><span class="s2">*</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">*</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">*</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span> <span class="o">*</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()</span> <span class="o">*</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply multiplication </span><span class="se">\&quot;</span><span class="s2">*</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_divide_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;division </span><span class="se">\&quot;</span><span class="s2">/</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">/</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">/</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span> <span class="o">/</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()</span> <span class="o">/</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply division </span><span class="se">\&quot;</span><span class="s2">/</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_modulus_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;modulus </span><span class="se">\&quot;</span><span class="s2">%</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">%</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">%</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span> <span class="o">%</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()</span> <span class="o">%</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply modulus </span><span class="se">\&quot;</span><span class="s2">%</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;addition </span><span class="se">\&quot;</span><span class="s2">+</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="p">(</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">+</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">+</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">+</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span> <span class="o">+</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply addition </span><span class="se">\&quot;</span><span class="s2">+</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_subtract_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;subtraction </span><span class="se">\&quot;</span><span class="s2">-</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="p">(</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">-</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">-</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">-</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span> <span class="o">-</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()</span> <span class="o">-</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply subtraction </span><span class="se">\&quot;</span><span class="s2">-</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_bitshiftleft_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">leftvalue</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_integertype</span><span class="p">(</span><span class="n">rightvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;left bit-shift </span><span class="se">\&quot;</span><span class="s2">&lt;&lt;</span><span class="se">\&quot;</span><span class="s2"> operator right operand, shift value, must be an integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;left bit-shift </span><span class="se">\&quot;</span><span class="s2">&lt;&lt;</span><span class="se">\&quot;</span><span class="s2"> operator right operand, shift value, is Null&quot;</span><span class="p">)</span>

        <span class="n">shiftamount</span> <span class="o">=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">integervalue</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shiftamount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">shiftamount</span> <span class="o">=</span> <span class="n">INTSIZE</span> <span class="o">-</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">shiftamount</span><span class="p">)</span> <span class="o">%</span> <span class="n">INTSIZE</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="p">(</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">shiftamount</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shiftamount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">shiftamount</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">-</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">shiftamount</span><span class="p">)</span> <span class="o">%</span> <span class="mi">32</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">shiftamount</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shiftamount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">shiftamount</span> <span class="o">=</span> <span class="mi">64</span> <span class="o">-</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">shiftamount</span><span class="p">)</span> <span class="o">%</span> <span class="mi">64</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">shiftamount</span><span class="p">),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply left bit-shift </span><span class="se">\&quot;</span><span class="s2">&lt;&lt;</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_bitshiftright_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">leftvalue</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_integertype</span><span class="p">(</span><span class="n">rightvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;right bit-shift </span><span class="se">\&quot;</span><span class="s2">&gt;&gt;</span><span class="se">\&quot;</span><span class="s2"> operator right operand, shift value, must be an integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;right bit-shift </span><span class="se">\&quot;</span><span class="s2">&gt;&gt;</span><span class="se">\&quot;</span><span class="s2"> operator right operand, shift value, is Null&quot;</span><span class="p">)</span>

        <span class="n">shiftamount</span> <span class="o">=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">integervalue</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shiftamount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">shiftamount</span> <span class="o">=</span> <span class="n">INTSIZE</span> <span class="o">-</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">shiftamount</span><span class="p">)</span> <span class="o">%</span> <span class="n">INTSIZE</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="p">(</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">shiftamount</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shiftamount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">shiftamount</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">-</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">shiftamount</span><span class="p">)</span> <span class="o">%</span> <span class="mi">32</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">shiftamount</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">shiftamount</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">shiftamount</span> <span class="o">=</span> <span class="mi">64</span> <span class="o">-</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">shiftamount</span><span class="p">)</span> <span class="o">%</span> <span class="mi">64</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">&gt;&gt;</span> <span class="n">shiftamount</span><span class="p">),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply right bit-shift </span><span class="se">\&quot;</span><span class="s2">&gt;&gt;</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_bitwiseand_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bitwise </span><span class="se">\&quot;</span><span class="s2">&amp;</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="p">(</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply bitwise </span><span class="se">\&quot;</span><span class="s2">&amp;</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_bitwiseor_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bitwise </span><span class="se">\&quot;</span><span class="s2">|</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="p">(</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">|</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">|</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">|</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply bitwise </span><span class="se">\&quot;</span><span class="s2">|</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_bitwisexor_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">valuetype</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;bitwise </span><span class="se">\&quot;</span><span class="s2">^</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="p">(</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">^</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">())</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">^</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">^</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply bitwise </span><span class="se">\&quot;</span><span class="s2">^</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_lessthan_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;less-than </span><span class="se">\&quot;</span><span class="s2">&lt;</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">GUID</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply less-than </span><span class="se">\&quot;</span><span class="s2">&lt;</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_lessthanorequal_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;less-than-or-equal </span><span class="se">\&quot;</span><span class="s2">&lt;=</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">GUID</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply less-than-or-equal </span><span class="se">\&quot;</span><span class="s2">&lt;=</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_greaterthan_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;greater-than </span><span class="se">\&quot;</span><span class="s2">&gt;</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">GUID</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply greater-than </span><span class="se">\&quot;</span><span class="s2">&gt;</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_greaterthanorequal_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;greater-than-or-equal </span><span class="se">\&quot;</span><span class="s2">&gt;=</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">GUID</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply greater-than-or-equal </span><span class="se">\&quot;</span><span class="s2">&gt;=</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_equal_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">,</span> <span class="n">exactmatch</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;equal </span><span class="se">\&quot;</span><span class="s2">=</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">==</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">==</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">==</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span> <span class="o">==</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()</span> <span class="o">==</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exactmatch</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span> <span class="o">==</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()),</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">==</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">GUID</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()</span> <span class="o">==</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">==</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply equal </span><span class="se">\&quot;</span><span class="s2">=</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_notequal_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">,</span> <span class="n">exactmatch</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="o">.</span><span class="n">nullvalue</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">),</span> <span class="kc">None</span>

        <span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_operands</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;not-equal </span><span class="se">\&quot;</span><span class="s2">!=</span><span class="se">\&quot;</span><span class="s2"> operator </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue_asint</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT32</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int32value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">INT64</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_int64value</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DECIMAL</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_decimalvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DOUBLE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_doublevalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exactmatch</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()),</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span><span class="o">.</span><span class="n">upper</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">GUID</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_guidvalue</span><span class="p">()),</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">valuetype</span> <span class="o">==</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">DATETIME</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_datetimevalue</span><span class="p">()),</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot apply not-equal </span><span class="se">\&quot;</span><span class="s2">!=</span><span class="se">\&quot;</span><span class="s2"> operator to </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_isnull_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">is_null</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_isnotnull_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="ow">not</span> <span class="n">value</span><span class="o">.</span><span class="n">is_null</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">_like_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">exactmatch</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># sourcery skip</span>

        <span class="c1"># If left is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLBOOLVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">STRING</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot perform </span><span class="se">\&quot;</span><span class="s2">LIKE</span><span class="se">\&quot;</span><span class="s2"> operation on </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> and </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">rightvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;right operand of </span><span class="se">\&quot;</span><span class="s2">LIKE</span><span class="se">\&quot;</span><span class="s2"> operation is Null&quot;</span><span class="p">)</span>

        <span class="n">leftoperand</span> <span class="o">=</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span>
        <span class="n">rightoperand</span> <span class="o">=</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_stringvalue</span><span class="p">()</span>
        <span class="n">testexpression</span> <span class="o">=</span> <span class="n">rightoperand</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">)</span>
        <span class="n">startswith_wildcard</span> <span class="o">=</span> <span class="n">testexpression</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>
        <span class="n">endswith_wildcard</span> <span class="o">=</span> <span class="n">testexpression</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">startswith_wildcard</span><span class="p">:</span>
            <span class="n">testexpression</span> <span class="o">=</span> <span class="n">testexpression</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="k">if</span> <span class="n">endswith_wildcard</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">testexpression</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">testexpression</span> <span class="o">=</span> <span class="n">testexpression</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># &quot;*&quot; or &quot;**&quot; expression means match everything</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">testexpression</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="c1"># Wild cards in the middle of the string are not supported</span>
        <span class="k">if</span> <span class="s2">&quot;*&quot;</span> <span class="ow">in</span> <span class="n">testexpression</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;right operand of </span><span class="se">\&quot;</span><span class="s2">LIKE</span><span class="se">\&quot;</span><span class="s2"> expression </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">rightoperand</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> has an invalid pattern&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">startswith_wildcard</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exactmatch</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">leftoperand</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">testexpression</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">leftoperand</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">testexpression</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
                    <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">endswith_wildcard</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exactmatch</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">leftoperand</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">testexpression</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">leftoperand</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">testexpression</span><span class="o">.</span><span class="n">upper</span><span class="p">()):</span>
                    <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">startswith_wildcard</span> <span class="ow">and</span> <span class="n">endswith_wildcard</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exactmatch</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">testexpression</span> <span class="ow">in</span> <span class="n">leftoperand</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">testexpression</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">leftoperand</span><span class="o">.</span><span class="n">upper</span><span class="p">():</span>
                    <span class="k">return</span> <span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_notlike_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">:</span> <span class="n">ExpressionValueType</span><span class="p">,</span> <span class="n">exactmatch</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLBOOLVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="n">likeresult</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_like_op</span><span class="p">(</span><span class="n">leftvalue</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">,</span> <span class="n">valuetype</span><span class="p">,</span> <span class="n">exactmatch</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">err</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">FALSEVALUE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="k">if</span> <span class="n">likeresult</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">()</span> <span class="k">else</span> <span class="p">(</span><span class="n">TRUEVALUE</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_and_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLBOOLVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot perform </span><span class="se">\&quot;</span><span class="s2">AND</span><span class="se">\&quot;</span><span class="s2"> operation on </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> and </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">rightvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">()</span> <span class="ow">and</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">()),</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_or_op</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">leftvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">,</span> <span class="n">rightvalue</span><span class="p">:</span> <span class="n">ValueExpression</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Optional</span><span class="p">[</span><span class="n">ValueExpression</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="ne">Exception</span><span class="p">]]:</span>
        <span class="c1"># If left or right value is Null, result is Null</span>
        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">is_null</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">NULLBOOLVALUE</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">valuetype</span> <span class="o">!=</span> <span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="n">EvaluateError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;cannot perform </span><span class="se">\&quot;</span><span class="s2">OR</span><span class="se">\&quot;</span><span class="s2"> operation on </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">leftvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2"> and </span><span class="se">\&quot;</span><span class="si">{</span><span class="n">rightvalue</span><span class="o">.</span><span class="n">valuetype</span><span class="si">}</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ValueExpression</span><span class="p">(</span><span class="n">ExpressionValueType</span><span class="o">.</span><span class="n">BOOLEAN</span><span class="p">,</span> <span class="n">leftvalue</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">()</span> <span class="ow">or</span> <span class="n">rightvalue</span><span class="o">.</span><span class="n">_booleanvalue</span><span class="p">()),</span> <span class="kc">None</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
 
<hr />
<p>
    <a href="https://github.com/sttp/pyapi">GitHub Home</a>
    &nbsp;&nbsp;â¢&nbsp;&nbsp;
    <a href="https://pypi.org/project/sttpapi/">PyPi Package: sttpapi</a>
</p>
<br /><br />
Copyright Â© 2022, <a href="https://gridprotectionalliance.org/" target="_blank">Grid&nbsp;Protection&nbsp;Alliance</a>
<a href="https://github.com/sttp/pyapi">
    <img align="right" style="margin-top: -50px"
        src="https://raw.githubusercontent.com/sttp/pyapi/main/docs/img/LockPython_64High.png">
</a>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>